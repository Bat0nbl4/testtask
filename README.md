# Тестовое задание: Web-интерфейс администрирования пользователей

## Реализовал
Богомолов Олег Олегович
- Telegram: [Bat0nbl44](https://t.me/Bat0nbl44)
- Почта: [bat0nbl4@mail.ru](mailto:bat0nbl4@mail.ru)

## Описание
Web-приложение для управления пользователями с аутентификацией и разграничением прав. Реализует полный CRUD (создание, чтение, обновление, удаление) для записей пользователей с пагинацией и валидацией.

> [!WARNING]
> CRUD пользоватлей доступен только в случае авторизации под именем администратора.

Базовый Админ:
- Login: **admin**
- Password: **admin123**

## Окружение локальной разработки
- PHP 8.3
- MySQL 8.2
- Web-сервер [Open Server Panel (OSP)](https://ospanel.io/)

## Установка и настройка

Вся логика приложения не выходит за рамки папки [public](public/). Она же является корневой. [index.php](public/index.php) - это точка входа.

### Клонирование и развертывание
```bash
git clone <repository-url>
```

### Настройка веб-сервера
```apache
<VirtualHost *:80>
    ServerName testtask.local
    DocumentRoot /путь/к/проекту/public
    
    <Directory /путь/к/проекту/public>
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

## Настройка
### База данных
- Импортировать [SQL дамп](testtask_db.sql)
- Настроить подключение в файле конфигурации [db_conn.php](public/config/db_conn.php)

### Прочие конфиги
Настроить [config.php](public/config/config.php)

В APP_DOMEN необходимо указать домен, по которому доступно это приложение.

BASE_PATH и USE_BASE_PATH используются, когда корневой каталог приложения (public) находится глубже, чем полразумевает конфигурация apache и, скорее всего, их настройка, как остальных параметров, не потребуется.

[server_config.php](public/config/server_config.php) в изменениях не нуждается!

## Структура проекта
```text
public/
├── config/             # Конфигурационные файлы
├── controllers/        # Контроллеры MVC
│   ├── admin/          # Административные контроллеры
│   ├── catch/          # Обработчики ошибок
│   ├── main/           # Основные контроллеры
│   └── user/           # Контроллеры пользователей
├── middleware/         # Middleware для авторизации
├── public/             # Публичная директория (DocumentRoot)
│   └── index.php       # Точка входа
├── resources/          # Ресурсы приложения
│   └── render/         # Шаблоны и компоненты
│       ├── components/ # Компоненты представления
│       ├── templates/  # Основные шаблоны
│       └── views/      # Представления (view)
├── storage/            # Хранилище (сессии, кэш, логи)
│   └── sessions/       # Файлы сессий
├── vendor/             # Ядро фреймворка (самописное)
│   ├── data_base/      # Классы работы с БД
│   ├── helpers/        # Вспомогательные классы
│   ├── middleware/     # Базовый middleware
│   ├── rendering/      # Система шаблонов
│   ├── routing/        # Маршрутизатор
│   ├── security/       # Безопасность (хэши)
│   └── session/        # Работа с сессиями
└── README.md           # Эта документация
```

# Архитектура приложения

## MVC Паттерн
Приложение построено на архитектуре MVC (Model-View-Controller):
- Модель (Model): Классы [DB](public/vendor/data_base/DB.php) и [QueryBuilder](public/vendor/data_base/QueryBuilder.php) для работы с базой данных.
- Представление (View):
    - [Темплейты](public/resources/render/templates/). Осоновной и единсвенный темплейт - [app.php](public/resources/render/templates/app.php)
    - [Компонеты](public/resources/render/components/)
    - [Страницы (вьюхи)](public/resources/render/views/)
- Контроллер (Controller): Классы в директориях [controllers/](public/controllers/)

## Роутинг
Маршрутизация осуществляется через класс [Router](public/vendor/routing/Router.php):
- Статические методы Router::get() и Router::post()
- Группировка роутов через Router::group()
- Именованные маршруты для генерации URL
- Middleware для контроля доступа

## Middleware
Система промежуточного ПО для обработки запросов:
- [IsAuthMiddleware](public/middleware/IsAuthMiddleware.php) - требует аутентификации и редиректит на соотвествующую страницу
- [IsNotAuthMiddleware](public/middleware/IsNotAuthMiddleware.php) - запрещает доступ аутентифицированным пользователям. Скрывает гостевые страницы.
- [IsAdminMiddleware](public/middleware/IsAdminMiddleware.php) - проверяет права администратора. Выплёвывает "403" в случае запрета доступа.

## Работа с базой данных
- [DB класс](public/vendor/data_base/DB.php): Singleton для подключения к ДБ с помощью PDO
- [QueryBuilder](public/vendor/data_base/QueryBuilder.php): Fluent интерфейс для построения SQL запросов.

# Работа с приложением
## Аутентификация
1. Перейдите на 
> GET /user/login
2. Введите логин/пароль администратора (admin/admin123).
3. После успешной аутентификации доступен интерфейс.

## Просмотр списка пользователей
- Доступ:
> GET /admin/user/listpage=*страница пагинации*
- Пагинация: 10 записей на страницу.
- Сортировка: по ID в порядке убывания.

## Создание пользователя
1. Перейдите:
> GET /admin/user/create
2. Заполните форму:
    - Обязательные поля: логин, имя, фамилия, дата рождения, пол, роль.
    - Пароль: минимум 8 символов.
    - Подтверждение пароля.
3. Нажмите "Store".
> [!NOTE]
> Поля не указаны как *required* в html, что бы можно было просто увидеть реакцию на не пройденную валидацию.

## Редактирование пользователя
1. Из списка пользователей нажмите кнопку "Редактировать" с соответсвующей символикой.
2. Измените необходимые данные.
3. Сохраните изменения.

## Удаление пользователя
Из списка пользователей нажмите "Удалить". Кнопка со соответсвующей символикой.

## Debug
Для быстрого наполнения базы используйте:

> GET /admin/user/generate

Это создаст случайного пользователя с паролем "12341234".

Так же в подвале доступены все данные сессии в случае авторизации под именем администратора.

> [!WARNING]
> Эта возможность не безопастна и я это осознаю! Она доступна только в качестве ознакомительного с приложением сегмента, и только потому, что это не реальный бизнесс проект!